#!/bin/sh

set -e

echo "Need root to temporarily override VoiceOver launch settings"

# temporarily set VoiceOver daemon launch arguments
# -p -- skip splash screen
# -t appname -- limit VoiceOver activity to target app
# sudo launchctl debug gui/$UID/com.apple.VoiceOver -- \
#   "/System/Library/CoreServices/VoiceOver.app/Contents/MacOS/VoiceOver" \
#   -p \
#   -t "Safari" \
#   launchd -s

# start VoiceOver
/System/Library/CoreServices/VoiceOver.app/Contents/MacOS/VoiceOverStarter

open "$1" -a Safari

sleep 5

# osascript -e 'tell application "VoiceOver" to copy to pasteboard last phrase'
# osascript -e 'tell application "VoiceOver" to grab screenshot vo cursor'

kill "$(pidof VoiceOver)"

expected="$2"
actual="$(pbpaste)"

if [[ "$actual" =~ .*"$expected".* ]]; then
  echo "üëç passed assertion" || \
  exit 0
else
  echo "‚ùåfailed 1 assertion. Expected \"$expected\" in \"$actual\""
fi
